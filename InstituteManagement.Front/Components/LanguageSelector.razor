@using System.Globalization
@inject IJSRuntime JS
@inject NavigationManager Navigation
@rendermode InteractiveServer

<select @onchange="ChangeLanguage" class="form-select" style="width: 150px;"> 
    <option value="en" selected="@IsSelected("en")">English</option> 
    <option value="fa" selected="@IsSelected("fa")">فارسی</option> 
</select>

@code {
    private async Task ChangeLanguage(ChangeEventArgs e)
    {
        var culture = e.Value?.ToString() ?? "en";
        var uri = Navigation.Uri;
        var setLanguageUrl = $"/SetLanguage?culture={culture}&redirectUri={Uri.EscapeDataString(uri)}";
        Navigation.NavigateTo(setLanguageUrl, forceLoad: true);
    }

    private string IsSelected(string lang)
    {
        var current = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
        return current == lang ? "selected" : null;
    }
}